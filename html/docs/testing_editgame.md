# Тестирование функции редактирования игры

## Обзор

Данный документ описывает тестовое покрытие для функции редактирования игры (`pages/editgame.php`). Тесты созданы по аналогии с тестами создания игры и обеспечивают полное покрытие функциональности редактирования.

## Структура тестов

### Unit тесты (`tests/unit/EditGameTest.php`)

Модульные тесты проверяют отдельные аспекты функции редактирования игры:

#### 1. Позитивные сценарии (тесты 1.x)

- **testEditBasicGameParameters**: Редактирование всех основных параметров игры
- **testEditGameNameOnly**: Редактирование только названия игры
- **testEditMapSize**: Редактирование размеров карты (минимальные и максимальные значения)
- **testEditTurnType**: Редактирование типа ходов (все допустимые варианты)
- **testLoadGameDataForEditing**: Загрузка данных игры для редактирования (GET запрос)

#### 2. Негативные сценарии (тесты 2.x)

- **testEditWithEmptyName**: Попытка редактирования с пустым названием
- **testEditWithInvalidMapSize**: Редактирование с неверными размерами карты
- **testEditWithInvalidTurnType**: Редактирование с неверным типом ходов
- **testEditNonExistentGame**: Попытка редактирования несуществующей игры
- **testEditWithoutGameId**: Редактирование без указания ID игры

#### 3. Сохранение данных (тесты 3.x)

- **testDataPreservationOnValidationError**: Сохранение введенных данных при ошибке валидации

#### 4. Безопасность (тесты 4.x)

- **testXSSInEditedGameName**: Защита от XSS-атак в названии игры
- **testVeryLongStringsInEdit**: Обработка очень длинных строк

#### 5. Обработка ошибок (тесты 5.x)

- **testLoadNonExistentGameForEditing**: Загрузка несуществующей игры
- **testLoadGameWithoutId**: Загрузка игры без указания ID

#### 6. Комплексные сценарии (тесты 6.x-7.x)

- **testMultipleValidationErrors**: Множественные ошибки валидации
- **testGameNotChangedOnValidationError**: Проверка неизменности игры при ошибках

### Integration тесты (`tests/integration/EditGameIntegrationTest.php`)

Интеграционные тесты проверяют полный процесс редактирования игры:

#### 1. Основные интеграционные тесты

- **testFullGameEditProcess**: Полный процесс редактирования игры
- **testEditedGameDataPersistence**: Сохранение отредактированных данных в БД
- **testEditDifferentTurnTypesIntegration**: Редактирование с различными типами ходов
- **testLoadGameDataForEditingIntegration**: Загрузка данных для редактирования

#### 2. Сохранение связанных данных

- **testPlayerOrderPreservationOnEdit**: Сохранение порядка игроков
- **testPlayerParametersPreservationOnEdit**: Сохранение параметров игроков
- **testEditGameWithRelatedDataPreservation**: Сохранение всех связанных данных

#### 3. Обработка ошибок и безопасность

- **testValidationErrorsIntegrationOnEdit**: Интеграционная обработка ошибок валидации
- **testSQLInjectionProtectionOnEdit**: Защита от SQL-инъекций

#### 4. Производительность и масштабируемость

- **testPerformanceEditWithMaxPlayers**: Производительность с максимальным количеством игроков
- **testMultipleGameEdits**: Редактирование нескольких игр подряд

## Покрываемые сценарии

### Валидация данных

1. **Название игры**:
   - Пустое название → ошибка
   - Обычное название → успех
   - Название с HTML-тегами → экранирование
   - Очень длинное название → обработка

2. **Размеры карты**:
   - Ширина/высота < 50 → ошибка
   - Ширина/высота > 500 → ошибка
   - Ширина/высота 50-500 → успех

3. **Тип ходов**:
   - Допустимые типы: `concurrently`, `byturn`, `onewindow` → успех
   - Недопустимый тип → замена на значение по умолчанию

### Работа с базой данных

1. **Обновление игры**:
   - Корректное обновление всех полей
   - Сохранение неизмененных полей
   - Откат при ошибках валидации

2. **Сохранение связанных данных**:
   - Игроки остаются без изменений
   - Порядок игроков сохраняется
   - Параметры игроков не изменяются
   - Номер хода и другие данные игры сохраняются

### Безопасность

1. **XSS-защита**: HTML-теги экранируются
2. **SQL-инъекции**: Параметризованные запросы защищают от инъекций
3. **Валидация ID**: Проверка существования игры перед редактированием

### Пользовательский интерфейс

1. **Загрузка данных**: Корректная загрузка всех данных игры для редактирования
2. **Сохранение формы**: Данные сохраняются в форме при ошибках валидации
3. **Обработка ошибок**: Понятные сообщения об ошибках

## Запуск тестов

### Запуск unit тестов
```bash
cd tests
php run_tests.php EditGameTest
```

### Запуск integration тестов
```bash
cd tests
php run_tests.php EditGameIntegrationTest
```

### Запуск всех тестов редактирования
```bash
cd tests
php run_tests.php EditGame
```

### Запуск всех тестов проекта
```bash
cd tests
php run_tests.php
```

## Отчеты

После выполнения тестов создаются следующие отчеты:

- **JUnit XML**: `tests/results/junit.xml`
- **TestDox HTML**: `tests/results/testdox.html`
- **Лог ошибок**: `tests/results/php_errors.log`

## Сравнение с тестами создания игры

Тесты редактирования игры созданы по аналогии с тестами создания (`CreateGameTest` и `CreateGameIntegrationTest`) с учетом специфики редактирования:

### Основные отличия:

1. **Предварительное создание данных**: Все тесты редактирования начинаются с создания тестовой игры и игроков
2. **Проверка обновления**: Вместо создания новых записей проверяется обновление существующих
3. **Сохранение связанных данных**: Дополнительные проверки сохранения данных игроков
4. **Обработка ID игры**: Дополнительная валидация наличия и корректности ID игры
5. **GET и POST сценарии**: Тестирование как загрузки данных (GET), так и сохранения (POST)

### Общие принципы:

- Аналогичная структура тестов (позитивные, негативные, безопасность)
- Те же проверки валидации данных
- Аналогичные тесты безопасности (XSS, SQL-инъекции)
- Схожие тесты производительности

## Заключение

Тестовое покрытие функции редактирования игры обеспечивает:

- ✅ Полную проверку валидации данных
- ✅ Тестирование всех позитивных и негативных сценариев
- ✅ Проверку безопасности (XSS, SQL-инъекции)
- ✅ Тестирование производительности
- ✅ Проверку сохранения связанных данных
- ✅ Интеграционное тестирование с базой данных

Тесты гарантируют надежность и безопасность функции редактирования игры на том же уровне, что и функция создания игры.
