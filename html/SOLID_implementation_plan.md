# Подробный план реализации SOLID принципов в проекте Civ

## Обзор
На основе анализа кода и файла `SOLID_todo.md`, проект частично соответствует SOLID, но требует доработки. План включает рефакторинг основной кодовой базы и обновление тестов. Цель — полное соответствие, бюджет — максимум 2 недели, приоритет: исправить нарушения, улучшить тестируемость и расширяемость.

## 1. Single Responsibility Principle (SRP) - Завершение
### Текущий статус: Частично решено.
### Цели: Каждый класс — одна ответственность.
### Шаги:
- __Unit__: Разделить на UnitStats, UnitMovement, UnitMissionHandler уже частично.
  - Создать UnitStats для расчёта статистики (здоровье, сила).
  - UnitMissionHandler: обработка миссий.
  - UnitMovement: расчёт движения и пути.
  - Оставить Unit как модель данных.
- __Game__: Разделить на GameManager (логика хода), UserManager, MapManager.
  - Game становится только моделью.
- __City__: Убедиться, что менеджеры (PopulationManager, ProductionManager) полностью изолированы.
- __Building__: Разделить на BuildingStats, BuildingEffects.
- __Время__: 3-4 дня.

## 2. Open-Closed Principle (OCP) - Завершение
### Цель: Классы открыты для расширения, закрыты для модификации.
### Шаги:
- Внедрить стратегии для новых типов: MissionCompleteInterface уже есть, расширить для всех типов юнитов/зданий.
- Для добавления типа юнита: Наследовать от базового типа, реализовать интерфейсы, без изменений в City::create_unit.
- Тестировать: Новые типы через фабрики, не меняя существующий код.
- Обновить City::calculate для делегации через стратегии.
- Время: 2-3 дня.

## 3. Liskov Substitution Principle (LSP) - Внедрение
### Цель: Подтипы взаимозаменяемы.
### Шаги:
- Ввести базовые интерфейсы:
  - IModel для всех моделей (Unit, Building, City).
  - IEntity для игровых сущностей.
- Обеспечить, что подклассы (например, от BuildingType) корректно реализуют методы базового класса.
- Тесты: Создать тесты подстановки, где любой UnitType заменяется другим.
- Время: 1-2 дня.

## 4. Interface Segregation Principle (ISP) - Разделение интерфейсов
### Цель: Узкие интерфейсы вместо толстых.
### Шаги:
- Добавить:
  - CellInterface: только методы клеток.
  - BuildingInterface: эффекты и тип.
  - UnitInterface: движение и миссии.
  - DatabaseInterface уже есть, расширить.
- Убрать толстые методы: Например, из City убрать calculate, делегировать.
- Время: 2 дня.

## 5. Dependency Inversion Principle (DIP) - Инъекция зависимостей
### Цель: Зависеть от абстракций.
### Шаги:
- Ввести DI-контейнер (Pimple или простой фабричный).
- Инжектировать в конструкторы: PlanetInterface вместо Planet.
- Обновить модели: City принимает UserInterface, etc.
- Тесты: Использовать DI для моков.
- Время: 3 дня.

## Обновление тестов
- Разделить тест-классы: Один тест-класс на один принцип (например, CityPopulationTest).
- Использовать моки: Для интерфейсов (PHPUnit).
- Переписать: UnitTest, CityTest, BuildingTest для новых структур.
- Добавить тесты соответствия LSP и DIP.
- Время: 4 дня параллельно с рефакторингом.

## План выполнения
- Фаза 1 (Дни 1-2): SRP для Unit и Game.
- Фаза 2 (Дни 3-4): OCP и ISP для типов.
- Фаза 3 (Дни 5-6): LSP и DIP, DI-контейнер.
- Фаза 4 (Дни 7-8): Обновление тестов, интеграция.
- Общее время: 8 дней.
- Риски: Регрессия в тестах — исправлять пошагово.
- Мониторинг: Запуск тестов после каждого этапа.
